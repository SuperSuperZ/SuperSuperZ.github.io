<!DOCTYPE html>
<html>

	<head>
		
<title>Nginx安装配置</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico">


<meta name="keywords" content="Nginx,">
<meta name="description" content="">


<script src="/js/jquery.min.js"></script>


	<meta name="generator" content="Hexo 4.2.1"></head>

	<body>
		
<link rel="stylesheet" href="/css/page.css">


<link rel="stylesheet" href="/css/page_cente.css">


<link rel="stylesheet" href="/css/atom-one-dark.css">


<link rel="stylesheet" href="/css/header.css">

	<div class="header">
		<div class="header-top">
			<div class="h-left">
				SuperSuperZ
				<!-- <a href="/">
					<img src="">
				</a> -->
			</div>
			<div class="h-right">
				<ul>
					
						
								<li>
									<a href="/">
										HOME
									</a>
									<span class="dot"></span>
								</li>
								
									
						
								<li>
									<a href="/archives">
										ARCHIVE
									</a>
									<span class="dot"></span>
								</li>
								
									
						
								<li>
									<a href="/categories">
										CATEGORIES
									</a>
									<span class="dot"></span>
								</li>
								
									
						
								<li>
									<a href="/tags">
										TAGS
									</a>
									<span class="dot"></span>
								</li>
								
									
						
								<li>
									<a href="/about">
										ABOUT
									</a>
									<span class="dot"></span>
								</li>
								
									
				</ul>
			</div>
			<div class="h-right-close">
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
					<path fill="none" d="M0 0h24v24H0z" />
					<path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z" fill="rgba(68,68,68,1)" />
				</svg>
			</div>
		</div>
	</div>
	<div class="sidebar">
    <div class="topo">
        <h2>SuperSuperZ</h2>
    </div>
    <ul>
        
        <li>
            <a href="/">HOME</a>
        </li>
        
        <li>
            <a href="/archives">ARCHIVE</a>
        </li>
        
        <li>
            <a href="/categories">CATEGORIES</a>
        </li>
        
        <li>
            <a href="/tags">TAGS</a>
        </li>
        
        <li>
            <a href="/about">ABOUT</a>
        </li>
        
    </ul>
</div>
<div class='shelter'
    style='cursor: pointer;display: none; position: fixed;left: 0;top: 0; right: 0;bottom: 0;background-color: #333;opacity:0.5;z-index: 108;'>
</div>
<style>
    .sidebar {
        width: 0;
        height: 100%;
        position: fixed;
        top: 0;
        right: 0;
        bottom: 0;
        background: #fff;
        z-index: 999;
        text-align: center;
        box-shadow: -6px 0 20px rgba(98, 94, 94, .815)
    }

    .topo {
        width: 100%;
        height: 200px;
        background: url(https://api.ixiaowai.cn/gqapi/gqapi.php) no-repeat;
        background-size: 100% 100%;
        position: relative;
        display: flex;
        align-items: flex-end
    }

    .topo h2 {
        color: #fff;
        z-index: 1;
        position: relative;
        margin: 0 0 10px 10px;
        font-size: 1.2em;
        box-sizing: border-box
    }

    .topo:before {
        content: '';
        background-image: url(/image/pattern.png);
        background-repeat: repeat;
        height: 100%;
        left: 0;
        position: absolute;
        top: 0;
        width: 100%;
        z-index: 1
    }

    .sidebar ul {
        width: 100%;
        margin-top: 50px
    }

    .sidebar ul li {
        height: 50px;
        list-style: none;
        font-size: 1.2em;
        text-align: right;
        margin-right: 10px
    }

    .sidebar ul li a {
        display: grid;
        color: #5d606a;
        text-overflow: ellipsis;
        width: 100%;
        text-decoration: none
    }

    .my_foot {
        width: 100%;
        padding: 10px;
        margin-bottom: 10px;
        position: absolute;
        bottom: 0
    }

    .my_foot a {
        text-decoration: none;
        margin-right: 10px;
        display: inline-block
    }

    .my_foot a img {
        width: 30px;
        height: 30px
    }
</style>

<script>
    $(function () { $('.h-right-close>svg').click(function () { $('.sidebar').animate({ width: "66%" }, 500); $('.shelter').fadeIn("slow") }); $('.shelter').click(function (e) { $('.sidebar').animate({ width: "0" }, 500); $('.shelter').fadeOut("slow") }) })
</script>
		<script>
			$(function () { $(window).scroll(function () { if ($(document).scrollTop() > 100) { $(".header-top").removeClass("header-move2"); $('.header-top').addClass('header-move1') } else { $(".header-top").removeClass("header-move1"); $('.header-top').addClass('header-move2') } }) });
		</script>
<div class="header-bg ">
    <div class="bg-content">
        <ul class="tag">
            
            
            <li><a href="/tags/Nginx">Nginx</a></li>
            
            
        </ul>
        <h1>Nginx安装配置</h1>
        <div class="article-info">
            <div class="article-author">
                
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20">
                    <g>
                        <path fill="#12183A"
                            d="M6.187 15.265A6.47 6.47 0 0 0 10 16.5a6.47 6.47 0 0 0 3.813-1.235A4.99 4.99 0 0 0 10 13.5a4.99 4.99 0 0 0-3.813 1.765zM5.082 14.25A6.485 6.485 0 0 1 10 12c1.965 0 3.726.872 4.918 2.25a6.5 6.5 0 1 0-9.836 0zM10 18a8 8 0 1 1 0-16 8 8 0 0 1 0 16zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6zm0-1.5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3z">
                        </path>
                    </g>
                </svg>
                
                <span> <a href="">SuperSuperZ</a></span>
                <p>2020-03-14</p>
            </div>
        </div>
    </div>
</div>
<div class="article-content">
    <div id="article" class="content">
        <blockquote>
<p>参考：<a href="https://www.runoob.com/linux/nginx-install-setup.html" target="_blank" rel="noopener">菜鸟Nginx 安装配置</a></p>
</blockquote>
<h1 id="一、安装编译工具及库文件"><a href="#一、安装编译工具及库文件" class="headerlink" title="一、安装编译工具及库文件"></a>一、安装编译工具及库文件</h1><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">yum -y install make zlib zlib-devel gcc-c++ libtool  openssl openssl-devel<br></code></pre></td></tr></table></figure>

<h1 id="二、安装PCRE"><a href="#二、安装PCRE" class="headerlink" title="二、安装PCRE"></a>二、安装PCRE</h1><ul>
<li>PCRE 作用是让 Nginx 支持 Rewrite 功能。</li>
</ul>
<ol>
<li>下载并解压PCRE安装包,<a href="https://ftp.pcre.org/pub/pcre/" target="_blank" rel="noopener">PCRE下载地址</a><figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /usr/<span class="hljs-built_in">local</span>/src/<br><br>wget https://ftp.pcre.org/pub/pcre/pcre-8.44.tar.gz<br><br>tar zxvf pcre-8.44.tar.gz<br></code></pre></td></tr></table></figure></li>
<li>编译安装<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> pcre-8.44<br><br>./configure<br><br>make &amp;&amp; make install<br><br>pcre-config --version<br></code></pre></td></tr></table></figure>

</li>
</ol>
<h1 id="三、安装Nginx"><a href="#三、安装Nginx" class="headerlink" title="三、安装Nginx"></a>三、安装Nginx</h1><ol>
<li><p>下载并解压Nginx，<a href="http://nginx.org/en/download.html" target="_blank" rel="noopener">Nginx官网下载地址</a>,选择稳定版(Stable version)下载</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> /usr/<span class="hljs-built_in">local</span>/src/<br><br>wget http://nginx.org/download/nginx-1.16.1.tar.gz<br><br>tar zxvf nginx-1.16.1.tar.gz<br></code></pre></td></tr></table></figure>
</li>
<li><p>编译安装</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash"><span class="hljs-built_in">cd</span> nginx-1.16.1<br><br>./configure \<br>--prefix=/usr/<span class="hljs-built_in">local</span>/nginx \<br>--with-pcre=/usr/<span class="hljs-built_in">local</span>/src/pcre-8.44 \<br>--with-http_gzip_static_module \<br>--with-http_stub_status_module \<br>--with-http_ssl_module \<br>--with-file-aio \<br>--with-http_realip_module \<br>--http-client-body-temp-path=/var/tmp/nginx/client \<br>--http-proxy-temp-path=/var/tmp/nginx/proxy \<br>--http-fastcgi-temp-path=/var/tmp/nginx/fastcgi \<br>--http-uwsgi-temp-path=/var/tmp/nginx/uwsgi \<br>--http-scgi-temp-path=/var/tmp/nginx/scgi<br><br><span class="hljs-comment"># 执行上面命令需要在/var/tmp目录下建文件夹</span><br><br>make &amp;&amp; make install<br><br>/usr/<span class="hljs-built_in">local</span>/nginx/sbin/nginx -v<br></code></pre></td></tr></table></figure></li>
</ol>
<ul>
<li>关于configure命令参数说明：<a href="http://nginx.org/en/docs/configure.html" target="_blank" rel="noopener">http://nginx.org/en/docs/configure.html</a></li>
</ul>
<h1 id="四、Nginx基本配置"><a href="#四、Nginx基本配置" class="headerlink" title="四、Nginx基本配置"></a>四、Nginx基本配置</h1><ol>
<li><p>创建 Nginx 运行使用的用户 www</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">groupadd www <br><br>useradd -g www www<br></code></pre></td></tr></table></figure>
</li>
<li><p>配置nginx.conf，将/usr/local/nginx/conf/nginx.conf替换为以下内容</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">user</span>  www www;<br><span class="hljs-attribute">worker_processes</span>  <span class="hljs-number">1</span>;<br><br><span class="hljs-comment">#error_log  logs/error.log;</span><br><span class="hljs-comment">#error_log  logs/error.log  notice;</span><br><span class="hljs-comment">#error_log  logs/error.log  info;</span><br><span class="hljs-attribute">error_log</span> /usr/local/nginx/logs/nginx_error.log <span class="hljs-literal">crit</span>;<br><br><span class="hljs-attribute">pid</span>        /usr/local/nginx/nginx.pid;<br><br><span class="hljs-comment">#Specifies the value for maximum file descriptors that can be opened by this process.</span><br><span class="hljs-attribute">worker_rlimit_nofile</span> <span class="hljs-number">65535</span>;<br><span class="hljs-section">events</span> &#123;<br>    <span class="hljs-attribute">use</span> <span class="hljs-literal">epoll</span>;<br>    <span class="hljs-attribute">worker_connections</span>  <span class="hljs-number">65535</span>;<br>&#125;<br><br><br><span class="hljs-section">http</span> &#123;<br>    <span class="hljs-attribute">include</span>       mime.types;<br>    <span class="hljs-attribute">default_type</span>  application/octet-stream;<br><br>    <span class="hljs-attribute">log_format</span>  main  <span class="hljs-string">'<span class="hljs-variable">$remote_addr</span> - <span class="hljs-variable">$remote_user</span> [<span class="hljs-variable">$time_local</span>] "<span class="hljs-variable">$request</span>" '</span><br>                      <span class="hljs-string">'<span class="hljs-variable">$status</span> <span class="hljs-variable">$body_bytes_sent</span> "<span class="hljs-variable">$http_referer</span>" '</span><br>                      <span class="hljs-string">'"<span class="hljs-variable">$http_user_agent</span>" "<span class="hljs-variable">$http_x_forwarded_for</span>"'</span>;<br><br>    <span class="hljs-attribute">access_log</span>  logs/access.log  main;<br><br>    <span class="hljs-attribute">server_names_hash_bucket_size</span> <span class="hljs-number">128</span>;<br>    <span class="hljs-attribute">client_header_buffer_size</span> <span class="hljs-number">32k</span>;<br>    <span class="hljs-attribute">large_client_header_buffers</span> <span class="hljs-number">4</span> <span class="hljs-number">32k</span>;<br>    <span class="hljs-attribute">client_max_body_size</span> <span class="hljs-number">8m</span>;<br><br>    <span class="hljs-attribute">sendfile</span>        <span class="hljs-literal">on</span>;<br>    <span class="hljs-attribute">tcp_nopush</span>     <span class="hljs-literal">on</span>;<br><br>    <span class="hljs-comment">#keepalive_timeout  0;</span><br>    <span class="hljs-attribute">keepalive_timeout</span>  <span class="hljs-number">65</span>;<br>    <span class="hljs-attribute">tcp_nodelay</span> <span class="hljs-literal">on</span>;<br>    <span class="hljs-attribute">fastcgi_connect_timeout</span> <span class="hljs-number">300</span>;<br>    <span class="hljs-attribute">fastcgi_send_timeout</span> <span class="hljs-number">300</span>;<br>    <span class="hljs-attribute">fastcgi_read_timeout</span> <span class="hljs-number">300</span>;<br>    <span class="hljs-attribute">fastcgi_buffer_size</span> <span class="hljs-number">64k</span>;<br>    <span class="hljs-attribute">fastcgi_buffers</span> <span class="hljs-number">4</span> <span class="hljs-number">64k</span>;<br>    <span class="hljs-attribute">fastcgi_busy_buffers_size</span> <span class="hljs-number">128k</span>;<br>    <span class="hljs-attribute">fastcgi_temp_file_write_size</span> <span class="hljs-number">128k</span>;<br><br>    <span class="hljs-attribute">gzip</span> <span class="hljs-literal">on</span>; <br>    <span class="hljs-attribute">gzip_min_length</span> <span class="hljs-number">1k</span>;<br>    <span class="hljs-attribute">gzip_buffers</span> <span class="hljs-number">4</span> <span class="hljs-number">16k</span>;<br>    <span class="hljs-attribute">gzip_http_version</span> <span class="hljs-number">1</span>.<span class="hljs-number">0</span>;<br>    <span class="hljs-attribute">gzip_comp_level</span> <span class="hljs-number">2</span>;<br>    <span class="hljs-attribute">gzip_types</span> text/plain application/x-javascript text/css application/xml;<br>    <span class="hljs-attribute">gzip_vary</span> <span class="hljs-literal">on</span>;<br><br>    <span class="hljs-section">server</span> &#123;<br>        <span class="hljs-attribute">listen</span>       <span class="hljs-number">80</span>;<br>        <span class="hljs-attribute">server_name</span>  localhost;<br>        <span class="hljs-attribute">index</span> index.html index.htm index.php;<br>        <span class="hljs-attribute">root</span> /usr/local/nginx/html;<span class="hljs-comment">#站点目录</span><br><br>        <span class="hljs-comment">#charset koi8-r;</span><br><br>        <span class="hljs-comment">#access_log  logs/host.access.log  main;</span><br><br>        <span class="hljs-attribute">location</span> / &#123;<br>            <span class="hljs-attribute">root</span>   html;<br>            <span class="hljs-attribute">index</span>  index.html index.htm;<br>        &#125;<br>        <br>        <span class="hljs-attribute">location</span> <span class="hljs-regexp">~ .*\.(php|php5)?$</span><br><span class="hljs-regexp"></span>        &#123;<br>            <span class="hljs-comment">#fastcgi_pass unix:/tmp/php-cgi.sock;</span><br>            <span class="hljs-attribute">fastcgi_pass</span> <span class="hljs-number">127.0.0.1:9000</span>;<br>            <span class="hljs-attribute">fastcgi_index</span> index.php;<br>            <span class="hljs-attribute">include</span> fastcgi.conf;<br>        &#125;<br>        <span class="hljs-attribute">location</span> <span class="hljs-regexp">~ .*\.(gif|jpg|jpeg|png|bmp|swf|ico)$</span><br><span class="hljs-regexp"></span>        &#123;<br>            <span class="hljs-attribute">expires</span> <span class="hljs-number">30d</span>;<br>            <span class="hljs-comment"># access_log off;</span><br>        &#125;<br>        <span class="hljs-attribute">location</span> <span class="hljs-regexp">~ .*\.(js|css)?$</span><br><span class="hljs-regexp"></span>        &#123;<br>            <span class="hljs-attribute">expires</span> <span class="hljs-number">15d</span>;<br>            <span class="hljs-comment"># access_log off;</span><br>        &#125;<br>        <span class="hljs-attribute">access_log</span> <span class="hljs-literal">off</span>;<br>        <br>        <span class="hljs-comment">#error_page  404              /404.html;</span><br><br>        <span class="hljs-comment"># redirect server error pages to the static page /50x.html</span><br>        <span class="hljs-comment">#</span><br>        <span class="hljs-comment">#error_page   500 502 503 504  /50x.html;</span><br>        <span class="hljs-comment">#location = /50x.html &#123;</span><br>        <span class="hljs-comment">#    root   html;</span><br>        <span class="hljs-comment">#&#125;</span><br><br>        <span class="hljs-comment"># deny access to .htaccess files, if Apache's document root</span><br>        <span class="hljs-comment"># concurs with nginx's one</span><br>        <span class="hljs-comment">#</span><br>        <span class="hljs-comment">#location ~ /\.ht &#123;</span><br>        <span class="hljs-comment">#    deny  all;</span><br>        <span class="hljs-comment">#&#125;</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>检查配置文件nginx.conf的正确性命令： </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">/usr/<span class="hljs-built_in">local</span>/nginx/sbin/nginx -t<br></code></pre></td></tr></table></figure>
</li>
<li><p>启动Nginx</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">/usr/<span class="hljs-built_in">local</span>/nginx/sbin/nginx<br></code></pre></td></tr></table></figure>
</li>
<li><p>其他命令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><code class="hljs bash">/usr/<span class="hljs-built_in">local</span>/nginx/sbin/nginx -s reload            <span class="hljs-comment"># 重新载入配置文件</span><br>/usr/<span class="hljs-built_in">local</span>/nginx/sbin/nginx -s reopen            <span class="hljs-comment"># 重启 Nginx</span><br>/usr/<span class="hljs-built_in">local</span>/nginx/sbin/nginx -s stop              <span class="hljs-comment"># 停止 Nginx</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>Red Hat NGINX Init Script</p>
</li>
</ol>
<ul>
<li>Save this <a href="https://www.nginx.com/resources/wiki/start/topics/examples/redhatnginxinit/" target="_blank" rel="noopener">file</a> as <code>/etc/init.d/nginx</code></li>
</ul>
<h1 id="五、Nginx配置ssl证书"><a href="#五、Nginx配置ssl证书" class="headerlink" title="五、Nginx配置ssl证书"></a>五、Nginx配置ssl证书</h1><ol>
<li><p>购买免费个人型SSL证书</p>
</li>
<li><p>在SSL证书服务页，下载Nginx证书压缩包文件，压缩包内容如下</p>
</li>
</ol>
<ul>
<li>证书文件：以.pem为后缀或文件类型。</li>
<li>密钥文件：以.key为后缀或文件类型。</li>
</ul>
<ol start="3">
<li><p>在<code>/usr/local/nginx/conf</code>目录下，创建<code>cert</code>目录，并将下载的证书文件和密钥文件放到<code>cert</code>目录下</p>
</li>
<li><p>在<code>nginx.conf</code>文件,http括号中添加这一段虚拟主机配置，并按注释提示修改</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><code class="hljs nginx"><span class="hljs-comment">#HTTPS server</span><br><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span>       <span class="hljs-number">443</span> ssl;              <span class="hljs-comment">#SSL协议访问端口号为443。此处如未添加ssl，可能会造成Nginx无法启动。</span><br>    <span class="hljs-attribute">server_name</span>  domain.name;          <span class="hljs-comment">#将localhost修改为您证书绑定的域名，例如：www.example.com。</span><br>    <span class="hljs-attribute">index</span> index.html index.htm index.php;<br>    <span class="hljs-attribute">root</span> /usr/local/nginx/html;<span class="hljs-comment">#站点目录</span><br><br>    <span class="hljs-attribute">ssl_certificate</span>      cert/domain.name.pem;   <span class="hljs-comment">#将domain name.pem替换成您证书的文件名。</span><br>    <span class="hljs-attribute">ssl_certificate_key</span>  cert/domain.name.key;   <span class="hljs-comment">#将domain name.key替换成您证书的密钥文件名。</span><br><br>    <span class="hljs-comment">#ssl_session_cache    shared:SSL:1m;</span><br>    <span class="hljs-attribute">ssl_session_timeout</span>  <span class="hljs-number">5m</span>;<br><br>    <span class="hljs-attribute">ssl_ciphers</span> ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;  <span class="hljs-comment">#使用此加密套件。</span><br>    <span class="hljs-attribute">ssl_protocols</span> TLSv1 TLSv1.<span class="hljs-number">1</span> TLSv1.<span class="hljs-number">2</span>;   <span class="hljs-comment">#使用该协议进行配置。</span><br>    <span class="hljs-attribute">ssl_prefer_server_ciphers</span>  <span class="hljs-literal">on</span>;<br><br>    <span class="hljs-attribute">location</span> / &#123;<br>        <span class="hljs-attribute">root</span>   html;<br>        <span class="hljs-attribute">index</span>  index.html index.htm;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
<li><p>保存nginx.conf文件  </p>
</li>
<li><p>重新载入配置文件</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><code class="hljs awk"><span class="hljs-regexp">/usr/</span>local<span class="hljs-regexp">/nginx/</span>sbin<span class="hljs-regexp">/nginx -s reload</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>设置HTTP请求自动跳转HTTPS。<br>在需要跳转的HTTP站点下添加以下rewrite语句，实现HTTP访问自动跳转到HTTPS页面。 </p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><code class="hljs nginx"><span class="hljs-section">server</span> &#123;<br>    <span class="hljs-attribute">listen</span> <span class="hljs-number">80</span>;<br>    <span class="hljs-attribute">server_name</span> localhost;           <span class="hljs-comment">#将localhost修改为您证书绑定的域名，例如：www.example.com。</span><br>    <span class="hljs-attribute">rewrite</span><span class="hljs-regexp"> ^(.*)$</span> https://<span class="hljs-variable">$host</span><span class="hljs-variable">$1</span> <span class="hljs-literal">permanent</span>;         <span class="hljs-comment">#将所有http请求通过rewrite重定向到https。</span><br>    <span class="hljs-attribute">location</span> / &#123;<br>        <span class="hljs-attribute">index</span> index.html index.htm;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>阿里云官方教程  </p>
</li>
</ol>
<ul>
<li>在Nginx/Tengine服务器上安装证书<br><a href="https://help.aliyun.com/document_detail/98728.html?spm=a2c4g.11186623.6.584.78974b20KRg0u4" target="_blank" rel="noopener">https://help.aliyun.com/document_detail/98728.html?spm=a2c4g.11186623.6.584.78974b20KRg0u4</a></li>
</ul>
<h1 id="六、Nginx代理保留请求真实ip"><a href="#六、Nginx代理保留请求真实ip" class="headerlink" title="六、Nginx代理保留请求真实ip"></a>六、Nginx代理保留请求真实ip</h1><ul>
<li>nginx.conf 修改location<figure class="highlight nginx"><table><tr><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">location</span> / &#123;<br>    <span class="hljs-attribute">proxy_set_header</span> Host <span class="hljs-variable">$http_host</span>;<br>    <span class="hljs-attribute">proxy_set_header</span> X-Real-IP <span class="hljs-variable">$remote_addr</span>;<br>    <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-For <span class="hljs-variable">$proxy_add_x_forwarded_for</span>;<br>    <span class="hljs-attribute">proxy_set_header</span> X-Forwarded-Proto <span class="hljs-variable">$scheme</span>;<br><br>    <span class="hljs-attribute">proxy_pass</span> http://127.0.0.1:8080;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>

    </div>
</div>
<style>
    #noneimg img {
        display: none;
        z-index: 109;
        width: 600px !important;
        border-radius: 0px;
        position: fixed;
        box-shadow: 0 0 0px #c3c3c300 !important;
        left: 0;
        top: 0;
        right: 0;
        bottom: 0;
        margin: auto !important;
    }

    @media screen and (max-width:600px) {
        #noneimg img {
            width: 88%
        }
    }
</style>
<script>
    $(function () {
        $('#article').click(function (e) {
            if (e.target.tagName == "IMG") {
                if ($('#nonediv').length == 0) {
                    let MImg = `<div id='noneimg'><img src='${e.target.currentSrc}'></div>`;
                    let MDiv =
                        "<div id='nonediv' style='cursor: pointer;display: none; position: fixed;left: 0;top: 0; right: 0;bottom: 0;background-color: #333;opacity:0.5;z-index: 108;'></div>";
                    $('#article').append(MDiv);
                    $('#article').append(MImg);
                    $("#nonediv").fadeIn("slow");
                    $("#noneimg img").fadeIn("slow")
                }
            } else {
                if ($('#nonediv').length !== 0) {
                    $("#noneimg ").fadeOut("slow");
                    $("#nonediv").fadeOut("slow");
                    setTimeout(function () {
                        $('#nonediv').remove();
                        $('#noneimg').remove()
                    }, 500)
                }
            }
        });
        $('.article-content').addClass('content-move')
    });
</script>
<div class="Last-Next">
    
    <a href="/2020/03/17/2020-03-17-CTFd%E5%8A%A8%E6%80%81%E9%9D%B6%E6%9C%BA%E6%90%AD%E5%BB%BA/">
        <div class="last">
            <span>上一篇</span>
            <p>CentOS7-CTFd动态靶机搭建</p>
        </div>
    </a>
    

    
    <a href="/2020/03/14/2020-03-14-CentOS7%E6%B7%BB%E5%8A%A0%E5%BC%80%E6%9C%BA%E5%90%AF%E5%8A%A8%E8%84%9A%E6%9C%AC/">
        <div class="next">
            <span>下一篇</span>
            <p>CentOS7添加开机启动脚本</p>
        </div>
    </a>
    
</div>
		
<link rel="stylesheet" href="/css/food.css">

<div class="footer">
	<div class="Copyright">
		©2021 By SuperSuperZ. 改自主题：<a
			style="text-decoration: none;display: contents; color: #898F9F;"
			href="https://github.com/qiaobug/hexo-theme-quiet">Quiet</a>
	</div>
</div>

<script src="/js/jquery.min.js"></script>


<script src="/js/gotop.js"></script>


<style type="text/css">
    @media screen and (min-width: 600px) {
        .goTop>span {
            display: block;
            border-radius: 50%;
            width: 66px;
            height: 66px;
            cursor: pointer;
            opacity: 0.8;
            background: rgba(18, 24, 58, 0.06);
            text-align: center;
            border: 1px solid rgba(18, 24, 58, 0.06);

            transition: border .5s;
            -moz-transition: border .5s;
            /* Firefox 4 */
            -webkit-transition: border .5s;
            /* Safari 和 Chrome */
            -o-transition: border .5s;
            /* Opera */
        }

        .goTop>span:hover {
            border: 1px solid #6680B3;
        }


        .goTop {
            position: fixed;
            right: 30px;
            bottom: 80px;
        }

        .goTop>span>svg {
            width: 30px;
            height: 30px;
            margin-top: 17.5px;
            opacity: 0.7;
        }

    }

    @media screen and (max-width: 600px) {
        .goTop {
            display: none;
        }
    }
</style>
<div class="goTop" id="js-go_top">
    <span>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
            <g>
                <path d="M13 12v8h-2v-8H4l8-8 8 8z"></path>
            </g>
        </svg>
    </span>
</div>
<script>
    $('#js-go_top').gotoTop({ offset: 500, speed: 300, animationShow: { 'transform': 'translate(0,0)', 'transition': 'transform .5s ease-in-out' }, animationHide: { 'transform': 'translate(100px,0)', 'transition': 'transform .5s ease-in-out' } });
</script>
<script>
	console.log('\n %c 改自Hexo-Quiet 主题 %c https://github.com/QiaoBug/hexo-theme-quiet \n', 'color: #fadfa3; background: #030307; padding:5px 0;', 'background: #fadfa3; padding:5px 0;')
</script>
	</body>

</html>